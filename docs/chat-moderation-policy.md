# Политика антиабьюза и модерации чатов

## Ретенция и логирование
- Стандартные приватные диалоги между клиентом и исполнителем хранятся **6 месяцев** после последнего сообщения.
- Чаты, помеченные флагами риска, а также переписка в рамках спора, хранятся **до закрытия кейса + 90 дней** для арбитража и пост-фактум расследований.
- Метаданные жалоб, авто-флагов и действий сотрудников (audit trail) не очищаются и доступны через `moderation_staffactionlog`.

## Красные фразы и авто-флаги
| Категория | Примеры паттернов | Авто-эскалация |
|-----------|-------------------|----------------|
| Мошенничество | `western union`, `переведите на карту` | Немедленно создаётся кейс с приоритетом HIGH |
| Запрещённые реквизиты | `IBAN`, `BTC`, `USDT` | Кейс с приоритетом MEDIUM, блокировка ленты до ручной проверки |
| Оскорбления/ненависть | `идиот`, `тупица` | Кейс MEDIUM, уведомление участнику |
| Спам/внеплощадочные офферы | `жми ссылку`, `подписывайтесь на мой телеграм` | Кейс LOW, сбор статистики |

Каждое совпадение записывается в `moderation_chatmessageflag` (source=`automated`).

## Жалобы пользователей
- Пользователь может подать жалобу из UI на конкретное сообщение с категорией и комментарием.
- Повторная жалоба на тот же текст и категорию не принимается (уникальный индекс).
- При достижении **3 жалоб** на одну категорию автоматически создаётся кейс `ChatModerationCase` и выставляется SLA 2 часа.

## Эскалации и SLA
| Условие | Приоритет | SLA | Ответственный |
|---------|-----------|-----|---------------|
| Авто-флаг категории `fraud` | HIGH | 30 минут | Модератор L2 |
| 3+ жалоб на сообщение | MEDIUM | 2 часа | Модератор L1 |
| Повторный спам от пользователя за сутки | MEDIUM | 4 часа | Модератор L1 |
| Любая жалоба от VIP аккаунта | HIGH | 1 час | Shift lead |
| Отчёт от команды финансов | HIGH | 30 минут | Lead + Finance |

## Блокировки
- `ChatThread.blocked_until` — полная блокировка диалога с причиной.
- `ChatParticipantRestriction`:
  - `send_block` — пользователь не может отправлять сообщения.
  - `shadow_ban` — сообщения остаются в логе, но скрыты от второй стороны.
- Любое действие фиксируется в `StaffActionLog` с метаданными.
